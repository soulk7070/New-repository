# ðŸŽ¯ Membangun Workflow n8n: Microstock Automation

## Langkah 1: Setup Credentials di n8n

### A. Setup Google Sheets Credentials
1. **Buka n8n**: `http://localhost:5678`
2. **Buka Settings** (gear icon di sidebar)
3. **Credentials** â†’ **Add Credential**
4. **Cari "Google"** â†’ Pilih **"Google Service Account"**
5. **Isi Form:**
   - Name: `Google Sheets Microstock`
   - Service Account Email: (dari file JSON yang didownload)
   - Private Key: (copy dari file JSON, bagian "private_key")
6. **Save**

### B. Setup Gemini Pro Credentials  
1. **Add Credential** lagi
2. **Cari "HTTP"** â†’ Pilih **"Header Auth"**
3. **Isi Form:**
   - Name: `Gemini Pro API`
   - Header Name: `x-goog-api-key`
   - Header Value: `YOUR_GEMINI_API_KEY`
4. **Save**

### C. Setup Telegram Credentials
1. **Add Credential** lagi  
2. **Cari "Telegram"** â†’ Pilih **"Telegram Bot"**
3. **Isi Form:**
   - Name: `Telegram Microstock Bot`
   - Access Token: `YOUR_BOT_TOKEN`
4. **Save**

---

## Langkah 2: Buat Workflow Baru

1. **New Workflow** (+ icon)
2. **Rename workflow**: "Microstock Niche to Prompt Generator"

---

## Langkah 3: Tambah Node Pertama - Webhook (karena menggunakan ngrok)

### Node 1: Webhook Trigger  
1. **Drag node "Webhook"** ke canvas
2. **Configuration:**
   - HTTP Method: `POST`
   - Path: `microstock-webhook`
   - Respond: `Immediately`
   - Response Code: `200`
3. **Save**
4. **Copy Webhook URL** (akan muncul setelah save)
   - URL format: `https://your-ngrok-url/webhook/microstock-webhook`

### Setup Telegram Webhook:
1. **Buka browser, jalankan URL ini** (ganti YOUR_BOT_TOKEN dan YOUR_NGROK_URL):
   ```
   https://api.telegram.org/botYOUR_BOT_TOKEN/setWebhook?url=https://YOUR_NGROK_URL/webhook/microstock-webhook
   ```
2. **Harus muncul response**: `{"ok":true,"result":true,"description":"Webhook was set"}`

### Test Node 1:
- Kirim pesan ke bot Telegram: `teknologi AI`
- Check di n8n apakah webhook menerima data
- Jika berhasil, data message akan muncul di executions

---

## Langkah 4: Tambah Node Gemini Processing

### Node 2: HTTP Request (Gemini Pro)
1. **Drag "HTTP Request"** ke canvas
2. **Connect** dari Webhook
3. **Configuration:**
   - Method: `POST`
   - URL: `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent`
   - Authentication: pilih `Gemini Pro API`
   - Headers:
     ```json
     {
       "Content-Type": "application/json"
     }
     ```
   - Body (JSON):
     ```json
     {
       "contents": [{
         "parts": [{
           "text": "{{ $node['Webhook'].json.body.message.text }}\n\n[TEMPLATE KONSEP AKAN DITAMBAHKAN DI SINI]"
         }]
       }],
       "generationConfig": {
         "temperature": 0.7,
         "maxOutputTokens": 2048
       }
     }
     ```

### Template Prompt yang Akan Dimasukkan:
```
Kamu adalah seorang Creative Director, Fotografer Komersial berpengalaman, dan AI Artist.
Tugasmu adalah menerjemahkan satu ide atau niche microstock menjadi konsep gambar bergaya foto yang:
- kuat secara visual
- memiliki nilai jual tinggi untuk pasar internasional  
- dan tidak menggunakan gaya klise atau visual yang terlalu umum

[SISANYA SESUAI TEMPLATE YANG SUDAH ADA]

Niche: {{ $node['Webhook'].json.body.message.text }}

Output dalam format JSON:
{
  "concepts": [
    {
      "title": "judul konsep",
      "description": "deskripsi visual lengkap",
      "composition": "komposisi dan lensa",
      "lighting": "pencahayaan dan mood", 
      "uniqueness": "elemen konseptual",
      "location": "lokasi dan properti",
      "has_human": true/false,
      "comfyui_prompt
